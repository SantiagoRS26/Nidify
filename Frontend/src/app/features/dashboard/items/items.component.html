<div class="subheader">
    <h2>Ítems</h2>
    <div class="actions desktop-only">
        <button class="btn primary" (click)="openNew()">Nuevo ítem</button>
    </div>
    <button class="fab mobile-only" aria-label="Nuevo ítem" (click)="openNew()">＋</button>
    <div class="sr-only">Botón de acción flotante para crear un nuevo ítem</div>
</div>

<section class="items">
    <div class="toolbar card">
        <input class="search" type="search" placeholder="Buscar ítems" />
    </div>

    <div class="filters grid">
        <button class="chip active">Todos</button>
        <button class="chip">Únicos</button>
        <button class="chip">Recurrentes</button>
        <button class="chip">Necesario</button>
        <button class="chip">Opcional</button>
        <button class="chip">Capricho</button>
    </div>

    <div class="list grid">
        <div class="item card" *ngFor="let item of items()">
            <div class="item__head">
                <div>
                    <div class="item__title">{{ item.name }}</div>
                    <div class="item__meta">{{ getCategoryName(item.categoryId) }} • {{ getStatusLabel(item.status) }}</div>
                </div>
                <div class="item__price">{{ item.price | currency:item.currency }}</div>
            </div>
            <div class="item__footer">
                <div class="split">50% tú • 50% pareja</div>
                <div class="tags">
                    <span class="tag">Prioridad: {{ getPriorityLabel(item.priority) }}</span>
                    <button class="btn" (click)="edit(item)">Editar</button>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="modal" [class.open]="showNewItemModal()">
    <div class="backdrop" (click)="showNewItemModal.set(false)"></div>
    <div class="dialog card">
        <div class="dialog__header">
            <h3>{{ editingId() ? 'Editar ítem' : 'Nuevo ítem' }}</h3>
            <button class="icon" (click)="showNewItemModal.set(false)">✕</button>
        </div>
        <form class="dialog__body form-grid" [formGroup]="itemForm">
            <label>Nombre<input type="text" placeholder="Sillón" formControlName="name" /></label>
            <label>Categoría<select formControlName="categoryId">
                        <option value="">Sin categoría</option>
                        <option *ngFor="let cat of categories()" [value]="cat.id">{{ cat.name }}</option>
                    </select></label>
            <label>Tipo<select formControlName="type">
                        <option *ngFor="let t of itemTypeOptions" [value]="t.value">{{ t.label }}</option>
                    </select></label>
            <label>Precio<input type="text" placeholder="0" formControlName="price" currencyInput /></label>
            <label>Moneda<select formControlName="currency">
                        <option *ngFor="let c of currencies$ | async" [value]="c">{{ c }}</option>
                    </select></label>
            <label>Prioridad<select formControlName="priority">
                        <option *ngFor="let p of itemPriorityOptions" [value]="p.value">{{ p.label }}</option>
                    </select></label>
            <label>Estado<select formControlName="status">
                        <option *ngFor="let s of itemStatusOptions" [value]="s.value">{{ s.label }}</option>
                    </select></label>
            <label>Link de compra<input type="text" placeholder="https://..." formControlName="purchaseLink" /></label>
        </form>
        <div class="dialog__actions">
            <button class="btn" (click)="showNewItemModal.set(false)">Cancelar</button>
            <button class="btn primary" (click)="save()">Guardar</button>
        </div>
    </div>
</div>

<!-- Modal: Dividir pago (solo UI) -->
<div class="modal" [class.open]="showSplitModal()">
    <div class="backdrop" (click)="showSplitModal.set(false)"></div>
    <div class="dialog card">
        <div class="dialog__header">
            <h3>Dividir pago</h3>
            <button class="icon" (click)="showSplitModal.set(false)">✕</button>
        </div>
        <div class="dialog__body">
            <div class="split-grid">
                <label>Tu aporte (%)<input type="number" value="50" /></label>
                <label>Pareja (%)<input type="number" value="50" /></label>
            </div>
            <p class="text-muted" style="margin-top:8px">Puedes usar porcentajes. En el futuro se soportarán montos.</p>
        </div>
        <div class="dialog__actions">
            <button class="btn" (click)="showSplitModal.set(false)">Cancelar</button>
            <button class="btn primary">Aplicar</button>
        </div>
    </div>
</div>
